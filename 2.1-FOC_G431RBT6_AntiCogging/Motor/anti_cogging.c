// #include "anti_cogging.h"
#include "motor_runtime_param.h"
#include "conf.h"
#include "global_def.h"

const float Anti_Table[1024] = {0.110714, 0.100009, 0.089726, 0.084666, 0.07432, 0.062891, 0.055106, 0.050691, 0.061467, 0.07511, 0.064793, 0.07044, 0.060208, 0.041788, 0.018088, 0.000456, -0.015949, -0.031601, -0.046506, -0.055757, -0.06035, -0.064101, -0.068627, -0.071969, -0.07179, -0.070517, -0.073206, -0.072629, -0.069436, -0.064272, -0.063783, -0.06001, -0.050004, -0.038945, -0.028734, -0.013394, 0.006924, 0.013967, 0.002457, -0.008169, -0.011619, -0.025865, -0.043161, -0.052742, -0.060051, -0.062456, -0.068011, -0.07364, -0.075959, -0.072924, -0.073951, -0.075226, -0.074, -0.074247, -0.081939, -0.085387, -0.086616, -0.086011, -0.087257, -0.08325, -0.07453, -0.07071, -0.070588, -0.07211, -0.070147, -0.067242, -0.067182, -0.065895, -0.06042, -0.047102, -0.012944, 0.069397, 0.185507, 0.226316, 0.204785, 0.201003, 0.185409, 0.147094, 0.133502, 0.102844, 0.108589, 0.09611, 0.08493, 0.078065, 0.083661, 0.079645, 0.089893, 0.071214, 0.054856, 0.043786, 0.027083, 0.009424, 0.016222, 0.018024, 0.020373, 0.008982, 0.005827, 0.004811, -0.005135, -0.011405, -0.021365, -0.034193, -0.047361, -0.055456, -0.064069, -0.071097, -0.077598, -0.092605, -0.104773, -0.111819, -0.120529, -0.126132, -0.12663, -0.131754, -0.129238, -0.123178, -0.123487, -0.11767, -0.113908, -0.098926, -0.092521, -0.078811, -0.069379, -0.067163, -0.06678, -0.063537, -0.061972, -0.064455, -0.067716, -0.068168, -0.068565, -0.066536, -0.06227, -0.043676, -0.006876, 0.024882, 0.053195, 0.068233, 0.089398, 0.061342, 0.049778, 0.0488, 0.049969, 0.046061, 0.047491, 0.053113, 0.064728, 0.033634, 0.026461, 0.024259, 0.011533, 0.001951, -0.011413, -0.016592, 0.00863, 0.017851, 0.042698, 0.081511, 0.112352, 0.127013, 0.120449, 0.110266, 0.097276, 0.076161, 0.052442, 0.035235, 0.033402, 0.018901, 0.010382, 0.008352, 0.021949, 0.018249, 0.010928, -0.000343, -0.005943, -0.012777, -0.020607, -0.030068, -0.03446, -0.034196, -0.032762, -0.035684, -0.029811, -0.031882, -0.039802, -0.048588, -0.05626, -0.061615, -0.071867, -0.081201, -0.093805, -0.109888, -0.135486, -0.158466, -0.171003, -0.176654, -0.183146, -0.173515, -0.161398, -0.152176, -0.143809, -0.140343, -0.111856, -0.094031, -0.084193, -0.064167, -0.032438, 0.008695, 0.040871, 0.058727, 0.068898, 0.067974, 0.037798, 0.035975, 0.050442, 0.056251, 0.05405, 0.091119, 0.151368, 0.155763, 0.158674, 0.174335, 0.154582, 0.13445, 0.102438, 0.072943, 0.069948, 0.055453, 0.037532, 0.027846, 0.038536, 0.023742, 0.015976, 0.00398, 0.001205, -0.004305, -0.024345, -0.033954, -0.040369, -0.047556, -0.049403, -0.046602, -0.032457, -0.016751, 0.008734, 0.032725, 0.034511, 0.034379, 0.025382, 0.022817, 0.006462, -0.010976, -0.019562, -0.018786, -0.021625, -0.032565, -0.03351, -0.034391, -0.036384, -0.045572, -0.052179, -0.052054, -0.056441, -0.060024, -0.063951, -0.066866, -0.066625, -0.07014, -0.072242, -0.075285, -0.081022, -0.090377, -0.095791, -0.107943, -0.124244, -0.143611, -0.161968, -0.168018, -0.173057, -0.169404, -0.15463, -0.135166, -0.118973, -0.095441, -0.073143, -0.060002, -0.036269, 0.022382, 0.070085, 0.100025, 0.143608, 0.166073, 0.152724, 0.148504, 0.140234, 0.133735, 0.101048, 0.057883, 0.059046, 0.069283, 0.051979, 0.042452, 0.055913, 0.09056, 0.099895, 0.107745, 0.115818, 0.111302, 0.082571, 0.048574, 0.030438, 0.019601, 0.006869, -0.016095, -0.020923, -0.017978, -0.020806, -0.035202, -0.044054, -0.04604, -0.051315, -0.060279, -0.066577, -0.071201, -0.073143, -0.0778, -0.080912, -0.078538, -0.075684, -0.073208, -0.071318, -0.065855, -0.063096, -0.061183, -0.061271, -0.061236, -0.060781, -0.064019, -0.067137, -0.069994, -0.06875, -0.070418, -0.072008, -0.073063, -0.070798, -0.069559, -0.071808, -0.075809, -0.07446, -0.072662, -0.071318, -0.069082, -0.062733, -0.043653, -0.0319, -0.02848, -0.020399, -0.018747, -0.023053, -0.036714, -0.040348, -0.040927, -0.041146, -0.041699, -0.021824, 0.001724, 0.026127, 0.045641, 0.076581, 0.0925, 0.086617, 0.081132, 0.080182, 0.101742, 0.095484, 0.10002, 0.105904, 0.112962, 0.119418, 0.104556, 0.083158, 0.064429, 0.049148, 0.025098, -0.001247, -0.010407, -0.015966, -0.012318, -0.017872, -0.013323, 0.001957, 0.008827, 0.011667, 0.013559, 0.010183, -0.005994, -0.020169, -0.028893, -0.03461, -0.043439, -0.049928, -0.054481, -0.059187, -0.061489, -0.064438, -0.07049, -0.07647, -0.0814, -0.090722, -0.113451, -0.125439, -0.132617, -0.135651, -0.135847, -0.135576, -0.126265, -0.111993, -0.10637, -0.100475, -0.090754, -0.085468, -0.084586, -0.084106, -0.077375, -0.071883, -0.064655, -0.051151, -0.023578, 0.004046, 0.019493, 0.027345, 0.044049, 0.042909, 0.039265, 0.047271, 0.056211, 0.076923, 0.09036, 0.096853, 0.106682, 0.094792, 0.075253, 0.045565, 0.026773, 0.009368, -0.009516, -0.023667, -0.029768, -0.016561, -0.014562, -0.003653, 0.005049, 0.010861, 0.02173, 0.023884, 0.018797, 0.021922, 0.02762, 0.02017, 0.028156, 0.043563, 0.049898, 0.053578, 0.047427, 0.054765, 0.053541, 0.03783, 0.011191, -0.001948, -0.016168, -0.032308, -0.045445, -0.052772, -0.056486, -0.057696, -0.056505, -0.056015, -0.055367, -0.052701, -0.055368, -0.056521, -0.060314, -0.066934, -0.073403, -0.081787, -0.087632, -0.089126, -0.093658, -0.102803, -0.111043, -0.118386, -0.126359, -0.129388, -0.13725, -0.149774, -0.158956, -0.158202, -0.148255, -0.125253, -0.101241, -0.079066, -0.041106, 0.043448, 0.102465, 0.112332, 0.106184, 0.099822, 0.09468, 0.094102, 0.094892, 0.085933, 0.108458, 0.120405, 0.121035, 0.107949, 0.10443, 0.08529, 0.082479, 0.059255, 0.056999, 0.057009, 0.054203, 0.069949, 0.06621, 0.063512, 0.056758, 0.048371, 0.030692, 0.010213, -0.010068, -0.030103, -0.045631, -0.054331, -0.059549, -0.064795, -0.069086, -0.072544, -0.074135, -0.074167, -0.074719, -0.073014, -0.069674, -0.069141, -0.069919, -0.064875, -0.061413, -0.056315, -0.04507, -0.026599, -0.013471, 0.000848, 0.002386, -0.001196, -0.013989, -0.03161, -0.047427, -0.052862, -0.059284, -0.065132, -0.072016, -0.075544, -0.076424, -0.081641, -0.083286, -0.080958, -0.080274, -0.087076, -0.093502, -0.09399, -0.093856, -0.096107, -0.096439, -0.088567, -0.087196, -0.084597, -0.080068, -0.07331, -0.07053, -0.072009, -0.069876, -0.066377, -0.064453, -0.057974, -0.035527, 0.035735, 0.138413, 0.199128, 0.249597, 0.228212, 0.190549, 0.163863, 0.152791, 0.131025, 0.103797, 0.090774, 0.105926, 0.108935, 0.093309, 0.086209, 0.078865, 0.077414, 0.063698, 0.036217, 0.035852, 0.031869, 0.022002, 0.008729, 0.011053, 0.023788, 0.014913, 0.005656, 0.00904, 0.00824, -0.003882, -0.028205, -0.043904, -0.055896, -0.06303, -0.068962, -0.078689, -0.085988, -0.098394, -0.112196, -0.12346, -0.120922, -0.122941, -0.134941, -0.13209, -0.126395, -0.120478, -0.122395, -0.119464, -0.105311, -0.091457, -0.082782, -0.075778, -0.068452, -0.064878, -0.066249, -0.068115, -0.068911, -0.069568, -0.075363, -0.078794, -0.075939, -0.068789, -0.060723, -0.048419, -0.013713, 0.032502, 0.04796, 0.054318, 0.057529, 0.041948, 0.028086, 0.024282, 0.040897, 0.048719, 0.052032, 0.037863, 0.033483, 0.026854, 0.01323, -0.003661, -0.006703, -0.002752, -0.000661, -0.001332, 0.013886, 0.065667, 0.094758, 0.105971, 0.114504, 0.12183, 0.10691, 0.075128, 0.063576, 0.052253, 0.041346, 0.019312, 0.008283, 0.009718, 0.016357, 0.010801, 0.008405, 0.011824, 0.003407, -0.010819, -0.022909, -0.021682, -0.026906, -0.032734, -0.036238, -0.031463, -0.026946, -0.028879, -0.032107, -0.041776, -0.050645, -0.05735, -0.065007, -0.075643, -0.090647, -0.109788, -0.136205, -0.15547, -0.170333, -0.178026, -0.182021, -0.168421, -0.167359, -0.166155, -0.161274, -0.15032, -0.128304, -0.113399, -0.091574, -0.073091, -0.060196, -0.022341, 0.010232, 0.043488, 0.053486, 0.037912, 0.042706, 0.036569, 0.029368, 0.038567, 0.069395, 0.076884, 0.134285, 0.146028, 0.159356, 0.158792, 0.146006, 0.132995, 0.091581, 0.067446, 0.061739, 0.051164, 0.034748, 0.032416, 0.03926, 0.035238, 0.022142, 0.005148, 0.001599, -0.00363, -0.017171, -0.035187, -0.041634, -0.040238, -0.042621, -0.044778, -0.017725, 0.011206, 0.018147, 0.039275, 0.06437, 0.051086, 0.033368, 0.008744, 0.002588, -0.005666, -0.016699, -0.03309, -0.033161, -0.021541, -0.022051, -0.039255, -0.041028, -0.042983, -0.049083, -0.057388, -0.061357, -0.062881, -0.064133, -0.065039, -0.06611, -0.06545, -0.069092, -0.073992, -0.076804, -0.082045, -0.091645, -0.106407, -0.123249, -0.133827, -0.149208, -0.158852, -0.15708, -0.153461, -0.148532, -0.129083, -0.105003, -0.090662, -0.075041, -0.051379, -0.020379, 0.042563, 0.098552, 0.145007, 0.155899, 0.174266, 0.153719, 0.151991, 0.117903, 0.099837, 0.085849, 0.073124, 0.061974, 0.044911, 0.041084, 0.064164, 0.073655, 0.074767, 0.098139, 0.113912, 0.096707, 0.072158, 0.05635, 0.041202, 0.018712, -0.004667, -0.012139, -0.009948, -0.012133, -0.03173, -0.034358, -0.03372, -0.044007, -0.051325, -0.058263, -0.062445, -0.065903, -0.071488, -0.075966, -0.074882, -0.073407, -0.071591, -0.06948, -0.060738, -0.05716, -0.058561, -0.056802, -0.054278, -0.056688, -0.059677, -0.060784, -0.060175, -0.063595, -0.066523, -0.066072, -0.064778, -0.065079, -0.069618, -0.069104, -0.069388, -0.071267, -0.071255, -0.068733, -0.0663, -0.063934, -0.059145, -0.041542, -0.025143, -0.02582, -0.032753, -0.025362, -0.029815, -0.036947, -0.043755, -0.048242, -0.046903, -0.043792, -0.029327, 0.006302, 0.042004, 0.06258, 0.071506, 0.077529, 0.088689, 0.084315, 0.088254, 0.106171, 0.110986, 0.110894, 0.120871, 0.12258, 0.107701, 0.090753, 0.072981, 0.060182, 0.036623, 0.015222, 0.005051, -0.002484, -0.008693, -0.011594, -0.001543, 0.017003, 0.014641, 0.021876, 0.025501, 0.019404, 0.009033, -0.009306, -0.022301, -0.028918, -0.044101, -0.052726, -0.055788, -0.059053, -0.061645, -0.065593, -0.069082, -0.071711, -0.079379, -0.089281, -0.094129, -0.101426, -0.114557, -0.127241, -0.132969, -0.125487, -0.122122, -0.115423, -0.102234, -0.08998, -0.086599, -0.088692, -0.087972, -0.083069, -0.081131, -0.074788, -0.062884, -0.050793, -0.031081, -0.005186, 0.014137, 0.025716, 0.025813, 0.029868, 0.041799, 0.043951, 0.055417, 0.063917, 0.095969, 0.09742, 0.082968, 0.082997, 0.070357, 0.055931, 0.024661, 0.006303, -0.004288, -0.010032, -0.0214, -0.030559, -0.028459, -0.03088, -0.021268, -0.009932, 0.009165, 0.013606, 0.019381, 0.025396, 0.024772, 0.021966, 0.015809, 0.023452, 0.035605, 0.042407, 0.048221, 0.058847, 0.050673, 0.031135, 0.007913, -0.006381, -0.021222, -0.032604, -0.042041, -0.047235, -0.049343, -0.052106, -0.053652, -0.054761, -0.052408, -0.05152, -0.054307, -0.058324, -0.059819, -0.06398, -0.071721, -0.075719, -0.080866, -0.089583, -0.097726, -0.102259, -0.110072, -0.118582, -0.126393, -0.132155, -0.137433, -0.141626, -0.14491, -0.142877, -0.143264, -0.127971, -0.104688, -0.074805, -0.044245, 0.013742, 0.087217, 0.109837, 0.10192, 0.079639, 0.092712, 0.103139, 0.101707, 0.095613, 0.110048, 0.123851, 0.115142};

float step = 2 * PI / 1023;

float Anti_Cogging(void)
{
    int i = encoder_angle / step;
    return Anti_Table[i] + (Anti_Table[i + 1] - Anti_Table[i]) * ((encoder_angle - i * step) / step);
}